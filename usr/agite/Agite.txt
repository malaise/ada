Agite user guide
================
V12.1

General purpose
---------------
Agite (Ada GIT Editor) is a graphical front end of the 'Git' configuration
management tool.
It is directory-oriented.

Major functions are navigation in directories and history, file status, 
graphical diff, commit and push.

anchor:XCommandLine[]

Command line
------------
  Usage: agite [ -n | --no_history ] [ <path> | -p | --previous ]

By default Agite continuously stores the current directory in its
xref:XConfig[configuration file].
This allows restarting Agite in the same directory as when it stopped by
providing the argument '-p' or '--previous'.

On the other hand this feature is hardly compatible with several instances of
Agite running in parallel. Only one instance of the program shall save the
current directory, which is achieved by providing the argument '-n' or
'--no_history' to all the other instances.

Instead of previous directory the start-up directory can be explicitly
specified in the command line with '<path>'. If no path nor '--previous' is
specified then by default Agite starts in the current directory.

Environment variables
---------------------
AFPX_DATA_DIR::
Agite is based on Afpx screen manager, which reads the configuration files
AFPX.DSC, AFPX.FLD and AFPX.INI. Either theses files are in the current
directory at startup or the environment variable 'AFPX_DATA_DIR' must be
set to the directory containing these files.
+
Note: Agite unsets AFPX_DATA_DIR at start-up so its children don't inherit
from this setting.

AGITE_CONF_FILE::
Agite allows several settings to be defined in a 
xref:XConfig[configuration file]. By default this file is 
'$\{HOME}/.agite/agite.xml' but this can be overridden by setting the
environment variable 'AGITE_CONF_FILE' to the full path and name of the
configuration file. At least 'HOME' or 'AGITE_CONF_FILE' must be set in the
environment.

GIT_DIR::
Agite needs to know the root directory of the current Git sandbox (if any). It
finds it by locating, in current directory or above, the Git technical
directory.
By default it is named '.git' but this can be overridden by setting the
environment variable 'GIT_DIR' to the name of the Git directory.

anchor:XConfig[] 

Configuration file
------------------
User defined configuration
~~~~~~~~~~~~~~~~~~~~~~~~~~
Agite reads at start-up some user-defined configuration parameters:

anchor:XConfXterm[]

xterm::
This defines the command to be launched when the
xref:XXterm[XTerm] button is selected. Example: 'gnome-terminal --zoom=0.9'

anchor:XConfEditor[]

editor::
This defines the command to be launched for editing a file (for example
with the xref:XEdit[Edit] button). A space and the file name will be
concatenated to this string.
+
Note: This command shall start a GUI of editor like 'gedit' or a 'xterm -e vi'.
+
Note: The editor should not return until completion so that Agite
properly refreshes the status of files when it exits.

viewer::
This defines the command to be launched for viewing a file (for example
with the xref:XView[View] button). As the xref:XConfEditor[editor] it must be a
GUI, for example 'xterm -e cat' or 'xterm -e vi -M'.

anchor:XConfDiff[]

differator::
This defines the command to be launched for performing a xref:XDiff[Diff]
between two versions of a file. Agite will launch 'git difftool -y -x
<differator> HEAD -- <file>' for the diff between current file and GIT
repository and 'git difftool -y -x <differator> <ref_rev> <comp_rev> -- <file>'
for the diff between two revisions of a file.

anchor:XConfMake[]

make::
This defines the command to be launched for local compilation with the
xref:XMake[Make] button. It shall launch a GUI. +
Example: '#xterm -e 'sh -c "make; echo -n Done.; read a"'#'

anchor:XConfPeriod[]

period::
Agite refreshes the current status of files in the xref:Xdir[directory] screen
when it starts the xref:XEdit[Editor] and when it exit.
This is because this tool can modify the current status of local files. Still,
it is possible from a stand-alone program to also modify the list or status of
local files. This is why Agite periodically checks and redisplays the status of
local files. This parameter defines the period in seconds of this automatic
check.
+
Setting the value to 0.0 disables the feature.
+
Note: A manual refresh is always possible with the xref:XReread[Reread] button.

Agite persistent data
~~~~~~~~~~~~~~~~~~~~~
Agite also uses the configuration file to store information from one invocation
to another.

last_dir::
Agite continuously stores the current directory in this entry. See the 
xref:XCommandLine[argument] '-p' ('--previous') for how to use this feature
and the argument '-n' ('--no_history') for how to disable this feature.

bookmarks::
Agite stores the xref:XBook[bookmarks] in this section:

* blank lines have no 'Name' nor content,
* separators have a 'Name' and no content,
* bookmarks have a content and possibly a 'Name'.

NOTE: The DTD file 'agite.dtd' must be located according to the ''DOCTYPE''
directive of the Agite XML configuration file.

Agite screens
-------------
Agite is based on the following main menus:

* xref:XDir[Directory]: This is the first menu at start-up. It shows the content
of a directory.
* xref:XBook[Bookmarks]: This menu allows bookmarking directories and quickly
jumping to a bookmark.
* xref:XHist[History]: This shows the Git history of a file or directory, the
list of commits that have modified the file(s).
* xref:XDetails[Details]: This shows information on a commit, including the list
of files modified by the commit.
* xref:XStash[Stash]: This menu allows stashing the local worktree and managing
the stack of stashes.
* xref:XCommit[Commit]: This menu allows staging and commiting the local
changes.
* xref:XPush[Push]: This menu allows pushing local commits to a remote
repository.
* xref:XPull[Pull]: This menu allows pulling the current branch from a remote
repository.

anchor:XNavigation[]
The navigation is as follows:

                         +-----------+
                    /--->| Bookmarks |
                   /     +-----------+
                  /      +---------+       +---------+
                 /------>| History |<----->| Details |
                /        +---------+       +---------+
  +---------- +/         +-------+
  | Directory |--------->| Stash |
  +---------- +\         +-------+
                \        +--------+       +------+
                 \------>| Commit |------>| Push |
                  \      +--------+       +------+
                   \     +------+
                    \--->| Pull |
                         +------+

There are also a confirmation screen and an error screen that are called when
necessary.

All the screen transitions are based on the 'call-return' scheme.
So please note the double arrow between 'History' and 'Details': from the
'History' of a file (or dir) you can select a commit and see its 'Details'.
In this new screen you can select a file and see its 'History'... and so on.
Once this is done you need to "un-stack" all these menus (by clicking on
the 'Back' button in each) in order to go back to the 'Directory' menu.


Directory
~~~~~~~~~
anchor:XDir[]
The 'Directory' menu lists the git content, subdirectories and files, of
of current directory. Starting from top, the fields are:

.Environment
Title::
The first line shows in the middle the name and current version of Agite.
+
On the left is the indication of current Git branch.
+
On the right is the indication of current host (which normally is also
indicated in title of the X window of Agite).

.Directories
Root::
This line shows the root directory of the current Git sandbox. Clicking in this
fields moves current directory to the root.

anchor:XGo[]

Go::
This line shows the current directory. It also allows entering a path and going
to it by hitting the key 'Return' or clicking in th 'Go' button.

anchor:XReread[]

Reread::
Normally Agite re-scans the current directory and refreshes the list and status
when necessary, and also periodically if the feature is enabled (see
xref:XConfPeriod[period] configuration option). This button explicitly refreshes
the current display.

Dir Up::
This button allows moving up to parent directory.

Bookmarks::
This button activates the xref:XBook[Bookmarks] menu.

PushD and PopD::
These buttons allows storing the current directory ('PushD') then
allows moving back to it later on ('PopD').
+
How it works: Agite keeps a cache of two paths, D1 and D2.
'PushD' saves D1 as D2 and pushes current directory as D1,
while 'PopD' swaps D1 and D2 and moves to the new D1 (if D2 is empty then 'PopD'
makes a 'PushD' first. Note that PopD is disabled if it would lead to move to
current directory.
+
How to use it: At start-up current directory is automatically pushed and 'PopD'
is disabled. As soon as you move to another directory 'PopD' allows moving
back to the original one. Clicking on 'PusD' allows swapping between the
new pushed and the last pushed.

.List

anchor:XQuickSearch[]

Quick search::
On top of the list is a quick search area on two rows.
Clicking in any character of this area triggers a search of file
starting with this character. If found, the file becomes selected in the list
and at the top of the list area. Otherwise the selection is unchanged. +
A tick box button allows searching for directory (starting with the character
that will be clicked) instead of file.

The list::
The list shows the directories then the files of xref:XGo[current directory],
in alphabetical order.
+
Each directory starts with three spaces then the name then \'/'.
+
Each file is preceded by two characters of its Git status, index and local (see
'man git-status') then a space, then the name. Git status can be:

* ' ' = unmodified
* M = modified
* A = added
* D = deleted
* R = renamed
* C = copied
* U = updated but unmerged

+
After the name a character represents the kind: 

* ' ' fo a file, 
* '@' for a symbolic link, 
* '/' for a directory,
* '?' for other/unknown kind.

+
Only one entry is selected (in green) at a time.
+
A sigle click selects an entry for xref:XEdit[edition], 
xref:XDiff[difference] from Git reference, xref:XHistory[history] or
xref:XRevert[revert] operation.
+
A double click on a directory changes current directory to it. +
A double click on a file launches the xref:XEdit[editor] on it. +
A double click on a symbolic link makes one or the other (or nothing),
depending on the target of the link.

anchor:XNavig[]

Navigation in the list::

The simplest way to navigate in the list is to use the wheel of the mouse.
Combine it with 'Shift' for scrolling one page and with 'Ctrl' for scrolling
ten pages.
+
Another way is to use the navigation buttons 'Top', 'PgUp', 'Up',
'Down', 'PgDown' and 'Bottom'. The 'Center' button scrolls the list so that the
selected entry is as most as possible in the middle of the list area.
+
Another way is to use the keyboard: Up and Down arrows, Page Up, Page Down,
Ctrl + Page Up (for Top) and Ctrl + Page Down (for Bottom).
+
Keep in mind that the xref:XQuickSearch[quick search] is also a good way to
quickly find a file.

.Actions on current list selection
anchor:XEdit[]

Edit::
This button launches the editor (defined in the xref:XConfEditor[editor] entry
of the configuration file) on the file currently selected in the list, as a
double click on this file would do. +
It has no effect if current list selection is a directory.

anchor:XDiff[]

Diff::
*On a file*, this button launches the graphical difference tool (defined in
the xref:XConfDiff[differator] entry of the configuration file) to show the
current modifications (if any) of the selected file. It shows the differences
between the currently modified file and the version in Git HEAD. +
On a un-modified file it shows the last update of the file (the difference
introduced by the last commit involving the file).
+
*On a directory* (including './' but excluding '../'), this button launches the
difference on all the modified files of the selected directory and
of its sub-directories. +
It has no effect if the selected directory is the parent directory entry ('../')
or if there is no modified file under the selected directory.

anchor:XHistory[]

History::
This button switches to the screen that shows the xref:XHist[history] of a
file or directory.

anchor:XAdd[]

Add::
Adds to Git the current directory (its content in fact), the current file or
symbolic link.

anchor:XRevert[]

Revert::
This button reverts the local change on the current list selection. +
First, a simple screen asks to confirm or cancel the operation. +
Then, depending on the selection:

- If it is a directory then it will be deleted, which succeeds only if the
directory is empty.
- If it is a file or a symbolic link,
 * if unknown by Git, then it is removed,
 * if just added to Git, then it becomes unknown by Git,
 * if just deleted from GIT, then it is restored to its last committed content
 * if known by GIT and modified, then it is restored to its last committed
content,
 * if known by GIT and deleted, then it is restored to its last committed
content
 * if known by GIT and renamed, then the original file is restored to its last
committed content and the new one is reset as unknown by GIT

+
The Revert button has no effect on a file known by GIT and not modified.


.Other actions

anchor:XXterm[]

Xterm::
This button starts a X terminal by launching the command defined
in the xref:XConfXterm[xterm] entry of the configuration file.

anchor:XMake[]

Make::
This button makes a local compilation by launching the command defined
in the xref:XConfMake[make] entry of the configuration file.

Commit::
This button switches to the screen of xref:XCommit[commit] that allows commiting the the local
modifications.

Pull::
This button switches to the screen of xref:XPull[pull] that allows pulling the
current branch from a remote repository;

Exit::
A button makes Agite exit.

Bookmarks
~~~~~~~~~
anchor:XBook[]
Locations (directories) can be bookmarked. To bookmark a directory, first move
to it in the xref:XDir[directory] menu, then go in the 'bookmark' menu, then
click in the button xref:XAdd[AddCur]. This adds the current directory in the list.
Click in xref:XBookBack[Back] to go back to the xref:XDir[directory] menu.
Later on you can open the bookmark menu and double click on the entry, or
select it and click on xref:XGoto[Goto] to go back to this directory.

Bookmarks are saved in the xref:XConfig[configuration file] so that they 
are persistent from one session to another.

The bookmark menu shows the current directory and lists the known bookmarks.
This list can contain four kinds of entry:

* Anonymous bookmarks don't have name. They contain only the path to a
directory. Example:

 /home/user/ada

* Named bookmarks are created like anonymous ones but with a name set in the
'Name to add' field when clicking in xref:XAdd[AddCur]. The name appears in
parentheses before the path of the bookmark. Example:

 (Reposit) /home/user/ada/reposit

* Separators are created by setting a name (in 'Name to add') and clicking
in xref:XAdd[AddSep]. This creates a line with dashes and the name. Example:

 ----- Ada -----

* Blank lines can also be used to separate bookmarks. They are anonymous 
separators, created by clicking in xref:XAdd[AddSep] with no name set.

anchor:XAdd[]
The buttons 'AddCur' and 'AddSep' insert a named or anonymous entry (depending
on the field 'Name to add') below the current entry.

anchor:XGoto[]
The 'Goto' button allows changing current dir to the bookmark currently
selected and switches back to the xref:XDir[directory] menu.
Double clicking on the entry has the same effect. It has no effect on a
separator.

Bookmarks and separators can be organised with the buttons 'MovUp', 'MovDwn' and
can be deleted with the button 'Del', after confirmation when deleting a
bookmark.

Navigation in the list is the same as the xref:XNavig[navigation] in the
directory menu, with the mouse wheel, the keyboard and buttons.

anchor:XBookBack[]
The button 'Back' switches back to  the xref:XDir[directory] menu without
changing current directory.

History
~~~~~~~
anchor:XHist[]
This menu shows the name of the selected file and lists the history of all the
commits on current branch that have affected this file. +
The newest release (Head) is on top.

In case of a directory the menu shows the name of the directory (relative to
root) and lists the history of the commits of all the files in the directory
and in its sub-directories.

This lists follows the renamings of the file or directory.

.List
The list shows for each entry the date of the commit (format YYMMDD:HHMM)
a space then the comment of the commit.

Navigation in the list is the same as the xref:XNavig[navigation] in the
directory menu, with the mouse wheel, the keyboard and buttons.

The list can be very long, so there are several extra features on the history
list:

* The position of current page, in term of percentage of the history, is
displayed above the list,

* The indexes of left and right selection are also displayed above the list,

* A hyphen ('-') on the left side of the list indicates the current position
of the current page, as a scroll bar would do,

* You can click at a given row in this "scroll bar". The list will be moved
at the page corresponding to where you *release* the mouse button (and the
hyphen be will at this position).

anchor:XView[]

.View
Double click on an entry (a commit) or select an entry and click on the 'View'
button to view the version of the file that was committed.

When the current history is on a directory this feature is de-activated.
Still it is possible to list and view one by one the files of a commit with the
xref:XDetails[Details] menu.

anchor:XDiff1[]

.Diff
The 'Diff' button shows the differences between commits. When the history is on
a directory it applies to all the files of the directory and sub-directories
that were affected by the commit(s).

'Diff' can compare two arbitrary commits or show the changes of one commit:

* Diff between two commits. 
** Left click on an a entry of the list. It becomes green and the 'LeftSel'
above  the list shows the index of this entry from the Head.
** Right click on an a entry of the list. It becomes black and the 'RightSel'
above the list shows the index of this entry from the Head.
** Click on the 'Diff' button. This starts the xref:XConfDiff[differator] 
with the right (black) selection as reference and the left (green) selection
as the target of the difference. If the history is about a directory several
differators may be started.

* Diff of a commit.
** Ensure that there is no right selection (no entry on black and
'RightSel'= 0).
If there is one then find it and de-select it (by a right click). Alternatively 
you can right-select any entry and de-select it with a second right click on it.
** Left click on an the entry of the list. It becomes green and the 'LeftSel'
above the list shows the index of this entry from the Head.
** Click on the 'Diff' button. This starts the xref:XConfDiff[differator]
with the version before the selection as reference and the selection
as the target of the difference. If the history is about a directory several
differators may be started.

anchor:XDetail[]

.Detail
This button switches to a screen that shows the xref:XDetails[details] of the
commit currently (left-)selected in the history.

anchor:XRestore[]

.Restore
This button causes Agite to check that the current file is not locally
modified. If not, Agite asks for confirmation then restores the file into the
version currently (left-)selected in the history. This function is not active on
the history of a directory.

.Back
This button allows to return to xref:XDir[directory] menu.

NOTE: The history follows the the renamings of the file or directory but the
reference name (that is displayed above the history list) is used for the
xref:XView[view] and xref:XDiff1[Diff] operations.
As a consequence, Agite will fail to show a
file or a difference from a file if the entry in the history is before a
renaming. Still, it is possible to view a file that has been renamed with the
following operations:

* Select the file in the history
* Show the xref:XDetail[Details] of this commit
* Select the file in the xref:XDetails[details] of the commit
* Click on xref:XView[View] the file.

It is not possible to do a xref:XDiff1[Diff] between two versions of a file if
the file has been renamed or moved between the versions.

Details
~~~~~~~
anchor:XDetails[]
The 'Details' menu shows the details of a commit:

* The SHA-1 hash of the commit, that you can copy in the clipboard,
* The date and comment (up to three lines) of the commit, that you can
also alternatively copy in the clipboard,
* The list of all the files in the commit, each preceded by a letter:
** M Modified,
** A Added,
** D Deleted.

A specific entry '/' is added on top of the list, which represents the root of
the current sandbox.

For all other entries (files) of the list:

* double click on the entry or select the entry and click on 'View' allows 
viewing the file as it was committed,
* clicking on 'Hist' allows viewing the full history of the file,
* clicking on 'Diff' allows viewing the differences between the version before
and after the commit.
* clicking on 'Restore' allows restoring the file from the commit. As in the
xref:XRestore[Restore] from the history, there first a check that the file is
not locally modified, then a confirmation.

When the "/" entry is selected you can:

* click on the button 'History' to get the full history of the sandbox,
* click on the button 'Diff' to launch the differator on each file of
the commit (differences brought by the commit),
* click on the button 'Restore' to restore all the files of the commit,
if none of them is locally modified, and after a confirmation.

NOTE: Clicking on 'Hist' calls a new function to show the history, as explained
in the section on xref:XNavigation[navigation].

Stash
~~~~~
anchor:XStash[]
This menu works on the global repository, not on local directory. +
The screen shows the list of stashes, whith, for each entry, the stash number,
the branch and the text of the message.

.Current branch and root

This shows the actual branch and path of the root of current repository.

.Actions

The possible actions on the list of stashes are:

Add::

Enter a message /  name for the stash and click in the 'Add' button or press
the Return key. Agit stashes the current worktree (which performs a 'git reset
--hard'). The new stash appears in the list.

Apply::

Applies the stash currently selected in the list and returns to the
xref:XDir[Directory] menu.

Pop::

After confirmation, applies the stash currently selected in the list, removes
it from the list and returns to the xref:XDir[Directory] menu.

Drop::

After confirmation, drops (deletes) the stash currently selected in the list.

NOTE: With the 'stash' menu you can perform a 'git reset --hard' in 5 clicks
from the xref:XDir[Directory] menu: +
- Stash (go to stash menu) +
- Add (add a new anonymous stash) +
- Drop (delete the newest stash) +
- Ok (to confirm deletion) +
- Back (to the xref:XDir[Directory] menu)

.Back

This button returns to the xref:XDir[Directory] menu.

Commit
~~~~~~
anchor:XCommit[]
This menu works on the global repository, not on local directory.

The screen shows the list of changes and allows entering a comment for the
commit:

.Current branch and root

This shows the actual branch and path of the root of current repository.

.Actions

The possible actions on the list of changes or the comment are:

Reread::

Re-read the current branch and the list of local changes.

Diff::

Show the difference between the current change and the Head for the current file
(selected in list).

Stage::

Stage the current file (selected in list).

Unstage::

Unstage the current file (selected in list).

StageAll::

Stage all the changes that are unstaged. Also proposes to add the untracked
(new) files.

Sign::

Append the user name and email address to the comment.

Clear::

Clear the comment fields.

NOTE: The Stage, Unstage and StageAll buttons are active only if there are local
changes.

.Comment

You can enter up to 7 lines of comment. +
Comment must not be empty when committing.

.List of changes

This list shows all the current changes, with 3 letters of status for each
file:

* The first column ('S') shows the summary of the status:
 - a '''+''' if all the changes of the file are staged,
 - a '''*''' if some changes are staged and some others are not,
 - empty if no changes are staged (e.g. locally modified, new or unchanged).
* The second column ('I') shows the changes in the index (that will be
committed),
* The third column ('L') shows the changes local to the worktree (that will not
be committed).

You can select a file and show its local differences, stage or unstage its
changes.

.Commit

Commit the staged changes.

NOTE: Ensure to enter a comment before committing.

If the commit succeeds then the list of changes is updated, otherwise
the error is reported through a specific screen.

NOTE: The Commit button is active only if there are staged changes.

.Push

This button activates the xref:XPush[Push] menu.

.Back

This button returns to the xref:XDir[Directory] menu.

Push
~~~~
anchor:XPush[]
The 'Push' menu allows pushing the local changes to a given remote
 repository. +
It shows:

.Current branch and root

This shows the actual branch and path of the root of the current workspace.

.List of known repositories

This lists the known remote repositories from which you can select the target. +
If the remote ''orign'' is defined then it is selected by default.

.Push

Pushes the local commits to the selected remote repository. +
If there is no error then agite returns back to the xref:XDir[Directory] menu,
otherwise the error is reported through a specific screen.

.Back

Moves back to the xref:XCommit[Commit] menu without pushing.

Pull
~~~~
anchor:XPull[]
The 'Pull' menu allows pulling the current branch from a given remote
repository. +
It shows:

.Current branch and root

This shows the actual branch and path of the root of the current workspace.

.List of known repositories

This lists the known remote repositories from which you can select the source. +
If the remote ''orign'' is defined then it is selected by default.

.Pull

Pulls the current branch from the selected remote repository. +
If there is no error then agite returns back to the xref:XDir[Directory] menu,
otherwise the error is reported through a specific screen.

.Back

Moves back to the xref:XDir[Directory] menu without pulling.

Interfaces with Git
-------------------
This section lists the commands and arguments passed to Git. This requires git
version 1.7.0 or above:

* A function gets Git version by calling 'git --version',

* A function lists local files by calling 'git ls-files' and
'git status \-- porcelain .',

* A function lists all changes by calling 'git status \-- porcelain .',

* A function lists the status of a file by calling 'git status \-- porcelain
<file>',

* A function lists the commits on local dir by calling
'git log --follow --date=iso --topo-order \-- <pwd>',

* A functions gets the hash of the last commit by calling 'git log
--pretty=format:"%H" -n -1 -- <pwd>'

* A function gets the details of a commit by calling
'git log --name-status --date=iso -n 1 <HSA1_hash>',

* A function lists the remote repositories by calling 'git remote',

* A function extracts a given version of a file (in a commit by calling
'git show <HSA1_hash>:<file> > <file>',

* A function launches the differator on a modified file (versus Head) by
calling 'git difftool -y -x <differator> HEAD \-- <file>',

* A function lauches the differator between two versions of a file (or dir) by
calling 'git difftool -y -x <differator> <ref_HSA1> <comp_HSA1> \-- <file>',

* A function reverts the local changes of a file by calling
'git checkout HEAD \-- <file>' 

* A function resets the staged sgtatus of a file by calling 'git reset \--
<file>',

* A function stages a change of a file by calling 'git add \-- <file>',

* A function removes a file from the index by 'git rm \-- <file>',

* A function commits the local changes by calling 'git commit -m
"<comment>"',

* A function pushes the local commits by calling 'git push <remote>',

* A function pulls the current branch by calling 'git pull <remote> <branch>',

* A function gets the user name and email by calling 'git config user.name'
and 'git config user.email',

* A function gets the name of current branch by calling 'git branch',

* A function gets the list of stashes by calling 'git stash list',

* A function saves the current stash by calling 'git stash save -q <message>',

* Three functions apply/pop/drop a stash by calling 'git stash apply/pop/drop
-q stash@{<num>}'.

