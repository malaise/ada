with Argument, Basic_Proc, Text_Line;
with Points, Point_Str, File;

procedure Export is

  Ascii_File : Text_Line.File_Type;

  procedure Error (Msg : in String)  is
  begin
    Basic_Proc.Put_Line_Error ("ERROR: " & Msg);
    Basic_Proc.Put_Line_Error ("Usage: " & Argument.Get_Program_Name
                             & " <src_approx_file> <dst_ascii_file>");
  end Error;

begin

  if Argument.Get_Nbre_Arg /= 2 then
    Error ("Invalid arguments");
    return;
  end if;

  begin
    Ascii_File.Create_All (Argument.Get_Parameter(Occurence => 2));
  exception
    when others =>
      Error ("Cannot create file " & Argument.Get_Parameter(Occurence => 2));
      return;
  end;

  declare
    The_Points : constant Points.P_T_The_Points
               := File.F_Read(Argument.Get_Parameter(Occurence => 1));
  begin

    Ascii_File.Put_Line ("# Generated by approx export");
    for I in The_Points'Range loop
      Ascii_File.Put_Line (Point_Str.Coordinate_Image(The_Points(I).X) & "  "
                         & Point_Str.Coordinate_Image(The_Points(I).Y));
    end loop;
    Ascii_File.Close_All;
    Basic_Proc.Put_Line_Output ("Done.");

  exception
    when Text_Line.Name_Error =>
      Error ("Cannot open file " & Argument.Get_Parameter(Occurence => 1));
      return;
    when Text_Line.Io_Error =>
      Error ("Reading file " & Argument.Get_Parameter(Occurence => 1));
      return;
  end;

end Export;

