#!/bin/bash

export PASSWORD="userpass"
export HOSTNAME
export HOSTIP=`gawk -v HOSTNAME=$HOSTNAME '
  ($2 == HOSTNAME) {
    ADDR = $1
    gsub ("\\\\.", "\\\\.", ADDR)
    print ADDR
    exit
  }
' /etc/hosts `


export TCPCHAT_DEBUG=""
export PORT="http"
while [ "$1" != "" ] ; do
  if [ "$1" = "-d" ] ; then
    export TCPCHAT_DEBUG=Y
    shift
  elif [ "$1" = "-p" ] ; then
    export PORT="$2"
    shift
    shift
  else
    break
  fi
done
if [ "$PORT" = "-" ] ; then
  export PORT_NAME="stdio"
else
  export PORT_NAME="port $PORT"
fi

if [ "$1" = "http" ] ; then
  FILE=http.xml
  echo "Http on $PORT_NAME"
elif [ "$1" = "rsh" ] ; then
  FILE=rsh.xml
  echo "Rsh on $PORT_NAME"
elif [ "$1" = "chats" ] ; then
  FILE=chats.xml
  echo "Chats on $PORT_NAME"
else
  echo "Usage: `basename $0` [ -d ] [ -p <port> ]  http | rsh | chats"
  echo " -d             for tcpchat debug"
  echo " -p <port>      for specific port or stdin if \"-\" (default \"http\")"
  echo " http or chats  script"
  echo "Note that using the port http requires root priviledges."
  exit 1
fi

exec tcpchat -p $PORT -f $FILE

